<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:"Palatino Linotype";
	panose-1:2 4 5 2 5 5 5 3 3 4;}
@font-face
	{font-family:"Bookman Old Style";
	panose-1:2 5 6 4 5 5 5 2 2 4;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;}
@font-face
	{font-family:"Segoe UI";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:"var\(--jp-code-font-family\)";
	panose-1:0 0 0 0 0 0 0 0 0 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:6.0pt;
	margin-right:0in;
	margin-bottom:12.0pt;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Palatino Linotype",serif;}
h1
	{mso-style-link:"Heading 1 Char";
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:.5in;
	text-indent:12px;;
	page-break-after:avoid;
	font-size:22.0pt;
	font-family:"Palatino Linotype",serif;}
h2
	{mso-style-link:"Heading 2 Char";
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:.25in;
	text-indent:12px;;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Palatino Linotype",serif;}
h3
	{mso-style-link:"Heading 3 Char";
	margin-top:2.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Calibri Light",sans-serif;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
	{margin-top:6.0pt;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Palatino Linotype",serif;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{margin-top:6.0pt;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:12.0pt;
	font-size:12.0pt;
	font-family:"Palatino Linotype",serif;}
p.MsoCommentText, li.MsoCommentText, div.MsoCommentText
	{mso-style-link:"Comment Text Char";
	margin-top:6.0pt;
	margin-right:0in;
	margin-bottom:12.0pt;
	margin-left:0in;
	font-size:10.0pt;
	font-family:"Palatino Linotype",serif;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{mso-style-link:"Header Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Palatino Linotype",serif;}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"Footer Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Palatino Linotype",serif;}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{mso-style-link:"Title Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:12.0pt;
	margin-left:0in;
	text-align:center;
	font-size:26.0pt;
	font-family:"Bookman Old Style",serif;
	letter-spacing:-.5pt;
	font-weight:bold;}
p.MsoTitleCxSpFirst, li.MsoTitleCxSpFirst, div.MsoTitleCxSpFirst
	{mso-style-link:"Title Char";
	margin:0in;
	margin-bottom:.0001pt;
	text-align:center;
	font-size:26.0pt;
	font-family:"Bookman Old Style",serif;
	letter-spacing:-.5pt;
	font-weight:bold;}
p.MsoTitleCxSpMiddle, li.MsoTitleCxSpMiddle, div.MsoTitleCxSpMiddle
	{mso-style-link:"Title Char";
	margin:0in;
	margin-bottom:.0001pt;
	text-align:center;
	font-size:26.0pt;
	font-family:"Bookman Old Style",serif;
	letter-spacing:-.5pt;
	font-weight:bold;}
p.MsoTitleCxSpLast, li.MsoTitleCxSpLast, div.MsoTitleCxSpLast
	{mso-style-link:"Title Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:12.0pt;
	margin-left:0in;
	text-align:center;
	font-size:26.0pt;
	font-family:"Bookman Old Style",serif;
	letter-spacing:-.5pt;
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:#0563C1;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:#954F72;
	text-decoration:underline;}
strong
	{font-family:"Calibri",sans-serif;}
pre
	{mso-style-link:"HTML Preformatted Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Courier New";}
p.MsoCommentSubject, li.MsoCommentSubject, div.MsoCommentSubject
	{mso-style-link:"Comment Subject Char";
	margin-top:6.0pt;
	margin-right:0in;
	margin-bottom:12.0pt;
	margin-left:0in;
	font-size:10.0pt;
	font-family:"Palatino Linotype",serif;
	font-weight:bold;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-link:"Balloon Text Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:9.0pt;
	font-family:"Segoe UI",sans-serif;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin-top:6.0pt;
	margin-right:0in;
	margin-bottom:12.0pt;
	margin-left:.5in;
	font-size:12.0pt;
	font-family:"Palatino Linotype",serif;}
p.MsoListParagraphCxSpFirst, li.MsoListParagraphCxSpFirst, div.MsoListParagraphCxSpFirst
	{margin-top:6.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Palatino Linotype",serif;}
p.MsoListParagraphCxSpMiddle, li.MsoListParagraphCxSpMiddle, div.MsoListParagraphCxSpMiddle
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Palatino Linotype",serif;}
p.MsoListParagraphCxSpLast, li.MsoListParagraphCxSpLast, div.MsoListParagraphCxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:12.0pt;
	margin-left:.5in;
	font-size:12.0pt;
	font-family:"Palatino Linotype",serif;}
span.Heading1Char
	{mso-style-name:"Heading 1 Char";
	mso-style-link:"Heading 1";
	font-family:"Times New Roman",serif;
	font-weight:bold;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Times New Roman",serif;
	font-weight:bold;}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-style-link:"Heading 3";
	font-family:"Calibri Light",sans-serif;
	font-weight:bold;}
span.TitleChar
	{mso-style-name:"Title Char";
	mso-style-link:Title;
	font-family:"Bookman Old Style",serif;
	letter-spacing:-.5pt;
	font-weight:bold;}
p.CodeStyle, li.CodeStyle, div.CodeStyle
	{mso-style-name:CodeStyle;
	mso-style-link:"CodeStyle Char";
	margin-top:6.0pt;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:.5in;
	background:white;
	font-size:11.0pt;
	font-family:Consolas;
	color:#1F3864;}
p.CodeStyleCxSpFirst, li.CodeStyleCxSpFirst, div.CodeStyleCxSpFirst
	{mso-style-name:CodeStyleCxSpFirst;
	mso-style-link:"CodeStyle Char";
	margin-top:6.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	background:white;
	font-size:11.0pt;
	font-family:Consolas;
	color:#1F3864;}
p.CodeStyleCxSpMiddle, li.CodeStyleCxSpMiddle, div.CodeStyleCxSpMiddle
	{mso-style-name:CodeStyleCxSpMiddle;
	mso-style-link:"CodeStyle Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	background:white;
	font-size:11.0pt;
	font-family:Consolas;
	color:#1F3864;}
p.CodeStyleCxSpLast, li.CodeStyleCxSpLast, div.CodeStyleCxSpLast
	{mso-style-name:CodeStyleCxSpLast;
	mso-style-link:"CodeStyle Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:.5in;
	background:white;
	font-size:11.0pt;
	font-family:Consolas;
	color:#1F3864;}
span.CodeStyleChar
	{mso-style-name:"CodeStyle Char";
	mso-style-link:CodeStyle;
	font-family:Consolas;
	color:#1F3864;
	background:white;}
p.Default, li.Default, div.Default
	{mso-style-name:Default;
	margin:0in;
	margin-bottom:.0001pt;
	text-autospace:none;
	font-size:12.0pt;
	font-family:"Calibri",sans-serif;
	color:black;}
span.HTMLPreformattedChar
	{mso-style-name:"HTML Preformatted Char";
	mso-style-link:"HTML Preformatted";
	font-family:"Courier New";}
span.HeaderChar
	{mso-style-name:"Header Char";
	mso-style-link:Header;}
span.FooterChar
	{mso-style-name:"Footer Char";
	mso-style-link:Footer;}
span.CommentTextChar
	{mso-style-name:"Comment Text Char";
	mso-style-link:"Comment Text";}
span.CommentSubjectChar
	{mso-style-name:"Comment Subject Char";
	mso-style-link:"Comment Subject";
	font-weight:bold;}
span.BalloonTextChar
	{mso-style-name:"Balloon Text Char";
	mso-style-link:"Balloon Text";
	font-family:"Segoe UI",sans-serif;}
span.ansi-red-fg
	{mso-style-name:ansi-red-fg;}
.MsoChpDefault
	{font-size:12.0pt;
	font-family:"Palatino Linotype",serif;}
.MsoPapDefault
	{margin-bottom:8.0pt;
	line-height:107%;}
 /* Page Definitions */
 @page WordSection1
	{size:8.5in 11.0in;
	margin:.8in .8in .8in .8in;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>

</head>

<body lang=VI link="#0563C1" vlink="#954F72">

<div class=WordSection1>

<p class=MsoTitle><span lang=EN-US>Image Classification <br>
Capstone Project</span></p>

<p class=Default align=right style='text-align:right'><i><span lang=EN-US
style='font-size:11.5pt;color:windowtext'>Thien Ngan Doan</span></i></p>

<p class=Default align=right style='text-align:right'><i><span lang=EN-US
style='font-size:11.0pt;color:windowtext'>Udacity ML Engineer Nanodegree </span></i></p>

<p class=Default align=right style='text-align:right'><i><span lang=EN-US
style='font-size:11.0pt;color:windowtext'>Jan 2021 </span></i></p>

<h1 style='text-indent:-.5in'><a name="_Toc93645200"></a><a name="_Toc92569599"><span
lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span>I.<span
style='font:7.0pt "Times New Roman"'> &nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Overview</span></a></h1>

<p class=MsoNormal><span lang=EN-US>When learning this program, we studied the
problems of image classification with 2 classes and with dog breed project of
133 classes. This project is also an image classification with the famous image
dataset CIFAR-10 containing 10 classes, we will go from the basic knowledge of
image data to the AWS process of training model and deploy its endpoint for
predicting.</span></p>

<p class=MsoNormal><span lang=EN-US>This project is focused on how to create
image data for a problem of image classification and step to step from
executing hyperparameter tuning to training and deploying endpoint for
predicting. This project is a wonderful example; it is an awesome case of
study.</span></p>

<p class=MsoNormal><span lang=EN-US>My goal is studying each step from analyzing
this type of data until predicting model to apply the same ideas in other
similar projects in real productions on AWS.</span></p>

<h1 style='text-indent:-.5in'><a name="_Toc93645201"></a><a name="_Toc92569600"><span
lang=EN-US>II.<span style='font:7.0pt "Times New Roman"'> &nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Problem Statement</span></a><span lang=EN-US> </span></h1>

<p class=MsoNormal><span lang=EN-US>We examine the original byte data from
cifar-10 pickle file and transform into all images to organize three folders <i>train</i>,
<i>test</i>, and <i>valid</i> for the problem of image classification. We will
determine the whole process on AWS:</span></p>

<p class=MsoListParagraphCxSpFirst style='text-indent:12px;'><span lang=EN-US>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Extract data from original byte-format data.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create the image data directories train, valid,
and test.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Try some pretrained models on local machine to
have a best selected model for perform on AWS. </span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Copy the image data directories train, valid,
and test into s3 bucket.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Tuning hyperparameters on AWS.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Training on AWS</span></p>

<p class=MsoListParagraphCxSpLast style='text-indent:12px;'><span lang=EN-US>7.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Create endpoint to predict. </span></p>

<p class=MsoNormal><span lang=EN-US>We use Pytorch to perform our models. We
will use pretrained model densenet for our data. In this project, we will use
densenet161 model on AWS to get the most powerful prediction of our models.</span></p>

<h1 style='text-indent:-.5in'><a name="_Toc93645202"></a><a name="_Toc92569601"><span
lang=EN-US>III.<span style='font:7.0pt "Times New Roman"'> &nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Evaluation Metrics</span></a><span lang=EN-US> </span></h1>

<p class=MsoNormal><a name="_Toc92569602"><span lang=EN-US>With this type of
image classification problem, we use the best compatible metric is </span></a><a
href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.accuracy_score.html"><span
lang=EN-US>accuracy classification score</span></a><span lang=EN-US>. </span></p>

<h1 style='text-indent:-.5in'><a name="_Toc93645203"><span lang=EN-US>IV.<span
style='font:7.0pt "Times New Roman"'> &nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Data Exploration</span></a></h1>

<p class=MsoNormal><a name="_Toc92569603"><span lang=EN-US>We use the dataset
provided by </span></a><a href="https://www.cs.toronto.edu/~kriz/cifar.html"><span
lang=EN-US>CIFAR-10 and CIFAR-100 datasets (toronto.edu)</span></a><span
lang=EN-US>. </span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>url=</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#CE9178'>'https://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gz'</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>save_name = </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#CE9178'>'cifar.tgz'</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>dest_dir=</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#CE9178'>'cifar10'</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#569CD6'>def</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'> </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#DCDCAA'>get_cifar</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>url</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>save_name</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>dest_dir</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>):</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>&nbsp; &nbsp; wget.download(url, save_name)</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>&nbsp; &nbsp; tf = tarfile.open(save_name)</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>&nbsp; &nbsp; tf.extractall(dest_dir)</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>get_cifar(url, save_name, dest_dir)</span></p>

<p class=MsoNormal><span lang=EN-US>The </span><a
href="https://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gz"><span
lang=EN-US>original data</span></a><span lang=EN-US> is an zip file of format
tar.gz, it consists of 8 pickled files containing data and related information.
Six important files of data are: </span></p>

<p class=MsoListParagraphCxSpFirst style='text-indent:12px;'><span lang=EN-US>-<span
style='font:7.0pt "Times New Roman"'> &nbsp;
</span></span><span lang=EN-US>data_batch_1: pickled file contains 10,000
images. </span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>-<span style='font:7.0pt "Times New Roman"'> &nbsp;
</span></span><span lang=EN-US>data_batch_2: pickled file contains 10,000
images.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>-<span style='font:7.0pt "Times New Roman"'> &nbsp;
</span></span><span lang=EN-US>data_batch_3: pickled file contains 10,000
images.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>-<span style='font:7.0pt "Times New Roman"'> &nbsp;
</span></span><span lang=EN-US>data_batch_4: pickled file contains 10,000
images.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>-<span style='font:7.0pt "Times New Roman"'> &nbsp;
</span></span><span lang=EN-US>data_batch_5: pickled file contains 10,000
images.</span></p>

<p class=MsoListParagraphCxSpLast style='text-indent:12px;'><span lang=EN-US>-<span
style='font:7.0pt "Times New Roman"'> &nbsp;
</span></span><span lang=EN-US>test_batch: : pickled file contains 10,000
images.</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#569CD6'>def</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'> </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#DCDCAA'>unpickle</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>file</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>):</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>&nbsp; &nbsp; </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#C586C0'>import</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> pickle</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>&nbsp; &nbsp; </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#C586C0'>with</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>open</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>file</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'rb'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>) </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>as</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> f:</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>dict</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> =
pickle.load(f, </span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#9CDCFE'>encoding</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>'bytes'</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>&nbsp; &nbsp; </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#C586C0'>return</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>dict</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>DIR=</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#CE9178'>'cifar10/cifar-10-batches-py/'</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>os.listdir(DIR)</span></p>

<p class=MsoNormal><span lang=EN-US>From these files, we extract and process to
transform them into three image data directories for training, validation, and
testing. There are ten classes in our data, and the distribution of ten classes
in each file is almost equally proportional.</span></p>

<p style='text-indent:12px;'><span lang=EN-US style='font-family:Arial'> 
Training data: 40,000 images of 4 files data_batch_1,
data_batch_2, data_batch_3, and data_batch_4</span></p>

<p style='text-indent:12px;'><span lang=EN-US style='font-family:Arial'></span><span lang=EN-US>Validation data: 10,000 images of file
data_batch_5.</span></p>

<p style='text-indent:12px;'><span lang=EN-US style='font-family:Arial'><span style='font:7.0pt "Times New Roman"'> 
</span></span><span lang=EN-US>Testing data: 10,000 images of file test_batch</span></p>

<h2><a name="_Toc93645204"><span lang=EN-US>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Process data from data_batch:</span></a><span
lang=EN-US> </span></h2>

<p class=MsoNormal><span lang=EN-US>First, we create </span></p>

<p class=MsoListParagraphCxSpFirst style='margin-left:.75in;text-indent:12px;'><span
lang=EN-US>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span lang=EN-US>train_dic</span></i><span lang=EN-US>: a list
contains 5 dictionary of data from 5 files <i>data_batch_1, data_batch_2, -,
data_batch_5</i>.</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:.75in;text-indent:12px;'><span
lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span lang=EN-US>test_dic</span></i><span lang=EN-US>: a
dictionary of data from <i>test_batch</i>.</span></p>

<p class=MsoListParagraphCxSpLast style='margin-left:.75in;text-indent:12px;'><span
lang=EN-US>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><i><span lang=EN-US>batch_dic</span></i><span lang=EN-US>: a
dictionary of data from <i>batches.meta</i>.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>fname =
DIR+</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>'data_batch_'</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>files =
[fname+</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#4EC9B0'>str</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>(k+</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#D4D4D4'>) </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>for</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> k </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>in</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>range</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>5</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>train_dic
= []</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>files</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>for</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> name </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>in</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> files:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; train_dic.append(unpickle(name))</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#6A9955'>#
len(train_dic)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>test_dic
= unpickle(DIR+</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#CE9178'>'test_batch'</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>batch_dic
= unpickle(DIR+</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#CE9178'>'batches.meta'</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal><span lang=EN-US>Each batch data dictionary has 4 same keys:
</span></p>

<p class=CodeStyle><span lang=EN-US>dict_keys([b'batch_label', b'labels',
b'data', b'filenames'])</span></p>

<p class=MsoNormal><span lang=EN-US>The keys of <i>batch_dic</i> are:</span></p>

<p class=CodeStyle><span lang=EN-US>dict_keys([b'num_cases_per_batch',
b'label_names', b'num_vis'])</span></p>

<p class=MsoNormal><span lang=EN-US>To examine one data batch to see inside
clearly, we create a pandas dataframe contains the related data for easy
processing. For example:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>dt_train
= train_dic[</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#B5CEA8'>0</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>][</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#569CD6'>b</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>'data'</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>print</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(dt_train.shape)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>dt_train
= pd.DataFrame(dt_train)</span></p>

<p class=CodeStyle><span lang=EN-US>(10000, 3072)</span></p>

<p class=MsoNormal><span lang=EN-US>Each batch has 10,000 rows of 3072 columns
of <i>uint8</i> number, so each row is data of a color image with resolution
(32, 32) - 3072 = 3*32*32.</span></p>

<p class=MsoNormal><span lang=EN-US>Similarly, we get:</span></p>

<p class=MsoListParagraphCxSpFirst style='text-indent:12px;'><span
class=CodeStyleChar><span lang=EN-US style='font-family:"Palatino Linotype",serif;
color:windowtext'>-<span style='font:7.0pt "Times New Roman"'> &nbsp;
</span></span></span><i><span lang=EN-US>filename</span></i><span lang=EN-US>:
from </span><span class=CodeStyleChar><span lang=EN-US style='font-size:11.0pt'>train_dic[0][b'filenames]</span></span></p>

<p class=MsoListParagraphCxSpLast style='text-indent:12px;'><span lang=EN-US>-<span
style='font:7.0pt "Times New Roman"'> &nbsp;
</span></span><i><span lang=EN-US>label</span></i><span class=CodeStyleChar><span
lang=EN-US style='font-size:11.0pt'>: from </span></span><span lang=EN-US>-</span><span
class=CodeStyleChar><span lang=EN-US style='font-size:11.0pt'>train_dic[0][b'labels']</span></span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>dt_labels
= train_dic[</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#B5CEA8'>0</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>][</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#569CD6'>b</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>'labels'</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>dt_labels
= pd.DataFrame({</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#CE9178'>'label'</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>: dt_labels})</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>dt_filenames
= train_dic[</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#B5CEA8'>0</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>][</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#569CD6'>b</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>'filenames'</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>dt_filenames
= [item.decode() </span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#C586C0'>for</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> item </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>in</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>
dt_filenames]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>dt_labels[</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'filename'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>] =
dt_filenames</span></p>

<p class=MsoNormal><span lang=EN-US>Notice that filename must be <i>decoded</i>.</span></p>

<p class=MsoNormal><span lang=EN-US>We write a function to transform <i>train_dic</i>
and <i>test_dic</i> into compatible dataframes.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>def</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>df_fr_dict</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>dict</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>):</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>'''</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>&nbsp;
&nbsp; dict: dictionary having data 'label', 'filename' and 'raw-image'</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>&nbsp;
&nbsp; '''</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; dt_labels = dict[</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#569CD6'>b</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>'labels'</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#6A9955'># decode filename</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; dt_filenames = [item.decode() </span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#C586C0'>for</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> item </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>in</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> dict[</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>b</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'filenames'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>]]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; df = pd.DataFrame({</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#CE9178'>'label'</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>: dt_labels,</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'filename'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>:
dt_filenames})</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; dt_data = pd.DataFrame(dict[</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#569CD6'>b</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'data'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>])</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; df = pd.concat([df, dt_data], </span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#9CDCFE'>axis</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>1</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>) &nbsp;
</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#C586C0'>return</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> df</span></p>

<p class=MsoNormal><span lang=EN-US>First, we transform test data:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>test =
df_fr_dict(test_dic)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>print</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(test[</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'label'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>].value_counts(),</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'---</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D7BA7D'>\n</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,
test.shape)</span></p>

<p class=CodeStyleCxSpFirst><span lang=EN-US>3��� 1000</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>8��� 1000</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>0��� 1000</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>6��� 1000</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>1��� 1000</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>9��� 1000</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>5��� 1000</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>7��� 1000</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>4��� 1000</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>2��� 1000</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>---</span></p>

<p class=CodeStyleCxSpLast><span lang=EN-US>(10000, 3074)</span></p>

<p class=MsoNormal><span lang=EN-US>Now, test dataframe has 10,000 rows, and
there are 10 labels from 0 to 9, and there are 1,000 rows for each label.</span></p>

<p class=MsoNormal><span lang=EN-US>We prepare for train dataframe and valid
dataframe through a list </span><span class=CodeStyleChar><span lang=EN-US
style='font-size:11.0pt'>df[]</span></span><span lang=EN-US>.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>df = []</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>for</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> k, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>dict</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>in</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>enumerate</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(train_dic):
</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; df.append(df_fr_dict(train_dic[k]))</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#DCDCAA'>print</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>(df[k].shape)</span></p>

<p class=CodeStyleCxSpFirst><span lang=EN-US>(10000, 3074)</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>(10000, 3074)</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>(10000, 3074)</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>(10000, 3074)</span></p>

<p class=CodeStyleCxSpLast><span lang=EN-US>(10000, 3074)</span></p>

<p class=MsoNormal><span lang=EN-US>Now, we create train and valid:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>train =
df[</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#B5CEA8'>0</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>for</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> k </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>in</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>range</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>1</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>4</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>):</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; train = pd.concat([train, df[k]])</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>valid
=df[</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#B5CEA8'>4</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>]</span></p>

<p class=MsoNormal><span lang=EN-US>Dataframe <i>train</i> has 40,000 rows and dataframe
<i>valid</i> has 10,000 rows. We have an almost uniform distribution for the 10
labels. -</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='margin-left:.25in;border-collapse:collapse;border:none'>
 <tr>
  <td width=331 valign=top style='width:248.15pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
  background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:
  Consolas;color:#D4D4D4'>valid[</span><span lang=EN-US style='font-size:10.5pt;
  font-family:Consolas;color:#CE9178'>'label'</span><span lang=EN-US
  style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>].value_counts()</span></p>
  <p class=CodeStyleCxSpFirst style='margin-left:0in'><span lang=EN-US>5���
  1025</span></p>
  <p class=CodeStyleCxSpMiddle style='margin-left:0in'><span lang=EN-US>9���
  1022</span></p>
  <p class=CodeStyleCxSpMiddle style='margin-left:0in'><span lang=EN-US>3���
  1016</span></p>
  <p class=CodeStyleCxSpMiddle style='margin-left:0in'><span lang=EN-US>1���
  1014</span></p>
  <p class=CodeStyleCxSpMiddle style='margin-left:0in'><span lang=EN-US>0���
  1014</span></p>
  <p class=CodeStyleCxSpMiddle style='margin-left:0in'><span lang=EN-US>8���
  1003</span></p>
  <p class=CodeStyleCxSpMiddle style='margin-left:0in'><span lang=EN-US>4����
  997</span></p>
  <p class=CodeStyleCxSpMiddle style='margin-left:0in'><span lang=EN-US>6����
  980</span></p>
  <p class=CodeStyleCxSpMiddle style='margin-left:0in'><span lang=EN-US>7����
  977</span></p>
  <p class=CodeStyleCxSpLast style='margin-left:0in'><span lang=EN-US>2���� 952</span></p>
  </td>
  <td width=331 valign=top style='width:248.15pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
  background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:
  Consolas;color:#D4D4D4'>valid[</span><span lang=EN-US style='font-size:10.5pt;
  font-family:Consolas;color:#CE9178'>'label'</span><span lang=EN-US
  style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>].value_counts()</span></p>
  <p class=CodeStyleCxSpFirst style='margin-left:0in'><span lang=EN-US>2���
  4048</span></p>
  <p class=CodeStyleCxSpMiddle style='margin-left:0in'><span lang=EN-US>7���
  4023</span></p>
  <p class=CodeStyleCxSpMiddle style='margin-left:0in'><span lang=EN-US>6���
  4020</span></p>
  <p class=CodeStyleCxSpMiddle style='margin-left:0in'><span lang=EN-US>4���
  4003</span></p>
  <p class=CodeStyleCxSpMiddle style='margin-left:0in'><span lang=EN-US>8���
  3997</span></p>
  <p class=CodeStyleCxSpMiddle style='margin-left:0in'><span lang=EN-US>1���
  3986</span></p>
  <p class=CodeStyleCxSpMiddle style='margin-left:0in'><span lang=EN-US>0���
  3986</span></p>
  <p class=CodeStyleCxSpMiddle style='margin-left:0in'><span lang=EN-US>3���
  3984</span></p>
  <p class=CodeStyleCxSpMiddle style='margin-left:0in'><span lang=EN-US>9���
  3978</span></p>
  <p class=CodeStyleCxSpLast style='margin-left:0in'><span lang=EN-US>5��� 3975</span></p>
  </td>
 </tr>
</table>

<h2><a name="_Toc93645205"></a><a name="_Toc92569604"><span lang=EN-US>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Transform data from </span></a><span lang=EN-US>dataframes into
image folders</span></h2>

<p class=MsoNormal><span lang=EN-US>We write a function to transform data from
a dataframe into a compatible folder <i>train</i>, <i>test</i>, and <i>valid, </i>and
attach a new column <i>fullname</i> to dataframe. Each folder has 10 child
folders named from 10 labels (0, 1, -, 9). </span></p>

<p class=MsoNormal><span lang=EN-US>We use the function <i>imsave</i> of <i>matplotlib</i>
to save image file.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>def</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>write_images</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>df</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>dirname</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>):</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; fullnames_list = []</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; image_size = </span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#B5CEA8'>32</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>*</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#B5CEA8'>32</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; image_resolution = (</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#B5CEA8'>32</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#D4D4D4'>,</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>32</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; data = np.array(df.drop(</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#9CDCFE'>columns</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=[</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'label'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'filename'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>]))</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; # </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#C586C0'>if</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'> os.path.isdir(dirname) == </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>False</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; # &nbsp; &nbsp; os.mkdir(dirname)</span><span style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>&nbsp; - </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>��� </span><span
style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>os</span><span
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>.</span><span
style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>makedirs</span><span
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>dirname</span><span
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>exist_ok</span><span
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> = </span><span
style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>True</span><span
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#C586C0'>for</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'> j </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#C586C0'>in</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>range</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>10</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>):</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; newdir = dirname+</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>'/'</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>+</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>str</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(j)</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'> </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;text-indent:.5in;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#4EC9B0'>- </span><span style='font-size:10.5pt;font-family:Consolas;
color:#4EC9B0'>os</span><span style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>.</span><span style='font-size:10.5pt;font-family:Consolas;
color:#DCDCAA'>makedirs</span><span style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>(</span><span style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>newdir</span><span style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>, </span><span style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>exist_ok</span><span style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'> = </span><span style='font-size:10.5pt;font-family:Consolas;
color:#569CD6'>True</span><span style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>)</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>����� - </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; # </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#C586C0'>if</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#D4D4D4'> os.path.isdir(newdir) == </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>False</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; # &nbsp; &nbsp; os.mkdir(newdir)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#C586C0'>for</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'> n </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#C586C0'>in</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>range</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(df.shape[</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>]):</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; row = data[n].astype(</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'uint8'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; fullname = dirname + </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'/'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> + </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>str</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(df[</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'label'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>][n]) + </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'/'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> + </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>str</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(df[</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'filename'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>][n])</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; fullnames_list.append(fullname)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; mat = </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#4EC9B0'>list</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#C586C0'>for</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> k </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>in</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>range</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>3</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>):</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mat.append(np.reshape(row[k*image_size:(k+</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>1</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)*image_size],</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>image_resolution))</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; image = np.dstack(</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>tuple</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(mat))</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; plt.imsave(os.path.normpath(fullname), image)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; tmp = pd.DataFrame({</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#CE9178'>'fullname'</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>: fullnames_list})</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; tmp = pd.concat([tmp, df], </span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#9CDCFE'>axis</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>1</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#C586C0'>return</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> tmp</span></p>

<p class=MsoNormal><span lang=EN-US>�The function is used easily.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>valid = write_images(df[</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>4</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>], </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'data/valid'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>test = write_images(test,
</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>'data/valid'</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal><span lang=EN-US>With train folder, we have a small loop to
write into train folder and create dataframe train simultaneously:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>train =
write_images(train, </span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#CE9178'>'data/train'</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal><span lang=EN-US>We write some code to check 3 new folders.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>def</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>check_files</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>dir</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>):</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>'''</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>&nbsp;
&nbsp; dir: directory for check filename lists </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>&nbsp;
&nbsp; '''</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; name_list = []</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#C586C0'>for</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'> dirname, _, filenames </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>in</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>
os.walk(</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#DCDCAA'>dir</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>):</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#C586C0'>for</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> filename </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>in</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>
filenames:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name_list.append(os.path.join(dirname,
filename))</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#C586C0'>return</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> name_list</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>&nbsp;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>for</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>dir</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>in</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> [</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'data/train'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'data/valid'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'data/test'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>]:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#DCDCAA'>print</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>(</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#DCDCAA'>dir</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D7BA7D'>\t</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>len</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(check_files(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>dir</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)))</span></p>

<p class=CodeStyleCxSpFirst><span lang=EN-US>data/train  �40000</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>data/valid  �10000</span></p>

<p class=CodeStyleCxSpLast><span lang=EN-US>data/test - �10000</span></p>

<p class=MsoNormal><span lang=EN-US>Now, we save all into csv files for further
use.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>test.to_csv(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'test.csv'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>index</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>False</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>train.to_csv(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'train.csv'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>index</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>False</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>valid.to_csv(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'valid.csv'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>index</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>False</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<h2><a name="_Toc93645206"></a><a name="_Toc92569605"><span lang=EN-US>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Process data from </span></a><span lang=EN-US>batch_dic</span></h2>

<p class=MsoNormal><span lang=EN-US>Examine <i>batch_dic</i>:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>batch_dic
= unpickle(DIR+</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#CE9178'>'batches.meta'</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>batch_dic.keys()</span></p>

<p class=CodeStyle><span lang=EN-US>dict_keys([b'num_cases_per_batch',
b'label_names', b'num_vis'])</span></p>

<p class=MsoNormal><span lang=EN-US>We get the class names from here and save
to csv file <i>classes.csv</i>.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>class_id
= []</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>class_name
= []</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>for</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> k, val </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>in</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>enumerate</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(batch_dic[</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>b</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'label_names'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>]):</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; class_id.append(k)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; class_name.append(val.decode())</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>classes
= pd.DataFrame({</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#CE9178'>'class_id'</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#D4D4D4'>: class_id, </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'class_name'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>:
class_name})</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>classes.to_csv(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'classes.csv'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>index</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>False</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>classes</span></p>

<p class=MsoNormal><span lang=EN-US>-</span></p>

<h2><a name="_Toc93645207"><span lang=EN-US>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Process data to s3</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Now, we are ready to copy our data into s3
bucket:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>sagemaker_session
= sagemaker.Session()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>role =
sagemaker.get_execution_role()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>region =
</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>&quot;us-east-1&quot;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>data_bucket
= </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>'cap2-ngandn18'</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#6A9955'># Upload
data to S3 bucket.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>datapath
= </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>'data'</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>inputs =
sagemaker_session.upload_data(</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#9CDCFE'>path</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=datapath, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>bucket</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=data_bucket,
</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>key_prefix</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=datapath)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>print</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(inputs)</span></p>

<p class=MsoNormal><span lang=EN-US>We use bucket <i>cap2-ngandn18</i> to save
folder <i>data</i>.</span></p>

<h2><a name="_Toc93645208"><span lang=EN-US>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Conclusion</span></a><span lang=EN-US> </span></h2>

<p class=MsoNormal><span lang=EN-US>After these steps of analyzing and
processing the data relationship, we create 3 image folders <i>train</i>, <i>test</i>,
and <i>valid</i> and 4 csv files <i>train.csv</i>, <i>valid.csv</i>, <i>test.csv</i>,
and <i>classes.csv</i>. After that, we copy folder <i>data</i> into bucket <i>cap2-ngandn18.</i></span></p>

<h1 style='text-indent:-.5in'><a name="_Toc93645209"></a><a name="_Toc92569609"><span
lang=EN-US>V.<span style='font:7.0pt "Times New Roman"'> &nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Models</span></a><span lang=EN-US> on Aws Sagemaker</span></h1>

<p class=MsoNormal><span lang=EN-US>The workflow of machine learning can be
displayed in the following chart.</span></p>

<p class=MsoNormal align=center style='text-align:center'><img border=0
width=571 height=248 id="Picture 19" src="project_6_files/image001.png"></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><a
href="https://udacity-reviews-uploads.s3.us-west-2.amazonaws.com/_attachments/3935679/1641716003/Capture2.JPG">Overview
of Machine Learning flowchart</a>.</span></p>

<p class=MsoNormal><span lang=EN-US>We perform our image classification model through
three steps.</span></p>

<h2 style='text-indent:0in'><a name="_Toc93645210"></a><a name="_Toc92569610"><span
lang=EN-US>1. </span></a><span lang=EN-US>Tuning hyperparameters</span></h2>

<p class=MsoNormal><span lang=EN-US>We create file <i>hpo.py</i> for tuning
job, in this file we use densenet161 model.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>def</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>net</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>():</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>'''</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>&nbsp;
&nbsp; Initializes our model</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>&nbsp;
&nbsp; A pretrained model: densenet161</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>&nbsp;
&nbsp; '''</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>num_classes</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> = </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>10</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>modelname</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>'densenet161'</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>model</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'> = </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#4EC9B0'>models</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>.</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>densenet161</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>pretrained</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>True</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#6A9955'># reset final fully connected layer</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>num_features</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> = </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>model</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>.</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>classifier</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>.</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>in_features</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>model</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>.</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#9CDCFE'>classifier</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> = </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>nn</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>.</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>Sequential</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#4EC9B0'>nn</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>.</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#4EC9B0'>Linear</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>num_features</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>256</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>),
&nbsp;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#4EC9B0'>nn</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>.</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#4EC9B0'>ReLU</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(), </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#4EC9B0'>nn</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>.</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#4EC9B0'>Dropout</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0.3</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>),</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#4EC9B0'>nn</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>.</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#4EC9B0'>Linear</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>256</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>num_classes</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>))</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>model</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'> = </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#9CDCFE'>model</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>.</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>to</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>device</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#DCDCAA'>print</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>(</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#9CDCFE'>modelname</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#C586C0'>return</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#9CDCFE'>model</span></p>

<p class=MsoNormal><span lang=EN-US>We calculate the normalized numbers mean
and standard deviation of our data to have a better result for transforming our
model.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#6A9955'># Update
mean, std 2022-01-13 cifar-10</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>mean</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> = [</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0.437687221685991</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0.4735875158811764</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0.4905213840275673</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>std</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> = [</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0.2475770728439971</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0.2313360013602289</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0.2351076898744994</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>]</span></p>

<p class=MsoNormal><span lang=EN-US>Loss criterion is <i>CrossEntropyLoss</i>
and optimizer is <i>optim.SGD</i>. On testing on local machine and Kaggle,
optim.SGD has more efficiency than optim.Adam, then We will use optim.SGD in
this project.</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>loss_criterion</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> = </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>nn</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>.</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>CrossEntropyLoss</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>()</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>optimizer</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> = </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>optim</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>.</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>SGD</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>model</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>.</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>parameters</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(), </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>momentum</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0.9</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>lr</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0.0005</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>weight_decay</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0.0005</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>) </span></p>

<p class=MsoNormal><span lang=EN-US>Full details <i>hpo.py </i>are in the
submission.</span></p>

<p class=MsoNormal><span lang=EN-US>We prepare for tuning job.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#6A9955'># Declare
ranges</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>from</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>
sagemaker.tuner </span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#C586C0'>import</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> (</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; IntegerParameter,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; CategoricalParameter,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; ContinuousParameter,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; HyperparameterTuner,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>hyperparameter_ranges
= {</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>&quot;lr&quot;</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>: ContinuousParameter(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0.0004</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0.001</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>),</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>&quot;batch_size&quot;</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#D4D4D4'>: CategoricalParameter([</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>16</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>32</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>64</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>])</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal><span lang=EN-US>With the estimator executed on instance
type <i>ml.g4dn.4xlarge</i> and metric is <i>average test loss</i>, we use Pytorch
framework version <i>1.9</i> and python version <i>3.8</i> to get the best
performance for tuning job.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>instance_type=</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'ml.g4dn.4xlarge'</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>from</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>
sagemaker.pytorch </span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#C586C0'>import</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> PyTorch</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>estimator
= PyTorch(</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>entry_point</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>&quot;hpo.py&quot;</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>role</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>=role,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>py_version</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>'py38'</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>framework_version</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>&quot;1.9&quot;</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>instance_count</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>instance_type</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=instance_type</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; )</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>objective_metric_name
= </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>&quot;average test loss&quot;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>objective_type
= </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>&quot;Minimize&quot;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>metric_definitions
= [{</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>&quot;Name&quot;</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>: </span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>&quot;average test loss&quot;</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>&quot;Regex&quot;</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>: </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>&quot;Test
set: Average loss: ([0-9</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D7BA7D'>\\</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>.]+)&quot;</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>}]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>tuner =
HyperparameterTuner(</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; estimator,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; objective_metric_name,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; hyperparameter_ranges,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; metric_definitions,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>max_jobs</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#B5CEA8'>4</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>max_parallel_jobs</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#B5CEA8'>2</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>objective_type</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=objective_type,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal><span lang=EN-US>With many time of testing on local machine
and on Kaggle, this training process gets much time, so we use <i>instance_count=1
</i>to make sure our Aws credit is not over budget.</span></p>

<p class=MsoNormal align=center style='text-align:center'><img border=0
width=584 height=551 id="Picture 3" src="project_6_files/image002.jpg"></p>

<p class=MsoNormal><span lang=EN-US>In tuning, there are 2 jobs failed because
of <i>CUDA out of memory</i> with batch_size 64, our data is too big for this
instance-type correspondence. Two successful training bobs in tuning process let
us get best hyperparameters. </span></p>

<p class=MsoNormal><img border=0 width=662 height=206 id="Picture 1"
src="project_6_files/image003.png"></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=234 valign=top style='width:175.25pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>Since our student policy of timeout on
  Aws gateway, and the tuning time is too long - about 5 hours for one training
  job, so after 10 hours we can't get these best hyperparameter by code, we can
  use the Sagemaker interface to view best training job to get manually.</span></p>
  </td>
  <td width=428 valign=top style='width:321.05pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><img border=0
  width=498 height=499 id="Picture 2" src="project_6_files/image004.png"></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>Then we set our model hyperparameters by
copying from this page.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>lr = </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'0.0008486603267461696'</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>batch_size
= </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>'16'</span></p>

<p class=MsoNormal><span lang=EN-US>And now, we prepare something to create the
training job for our model. </span></p>

<h2 style='text-indent:0in'><a name="_Toc93645211"><span lang=EN-US>2. Training
our model</span></a></h2>

<p class=MsoNormal><span lang=EN-US>From the tuning job, we find the new
powerful instance type for the training job, and from the <a
href="https://aws.amazon.com/ec2/instance-types/g4/">Aws g4dn page</a>, we use
the powerful <i>ml.g4dn.12xlarge</i> with large GPU memory for our training job.
File <i>train_model.py</i> is used for an <i>entry_point</i>.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#6A9955'># Create
and fit an estimator</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>hyperparameters
= {</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>'batch_size'</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>: batch_size,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'lr'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>: lr} </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#6A9955'>#
Training with best parameters</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>instance_type=</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'ml.g4dn.12xlarge'</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>estimator
= PyTorch(</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>role</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>=sagemaker.get_execution_role(),</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>instance_count</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>instance_type</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=instance_type,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>entry_point</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>&quot;train_model.py&quot;</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>framework_version</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>&quot;1.9&quot;</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>py_version</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>&quot;py38&quot;</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>hyperparameters</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=hyperparameters,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>profiler_config</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=profiler_config, </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#6A9955'># include the
profiler hook</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>debugger_hook_config</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#D4D4D4'>=debugger_hook_config, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#6A9955'>#
include the debugger hook</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>rules</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>=rules,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>estimator.fit({</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'train'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>:
s3_data_dir},</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>wait</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'> = </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#569CD6'>True</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal align=center style='text-align:center'><img border=0
width=438 height=403 id="Picture 4" src="project_6_files/image005.png"></p>

<p class=MsoNormal><span lang=EN-US>We want to get the information of debugging
and profiling, but once more, because of our student policy of timeout on Aws
gateway, our notebook gets lost connection, so we cannot get these info as
expected. Although we select a very powerful instance, the successful training
process takes nearly about 5 hours - 17661 seconds.</span></p>

<p class=MsoNormal align=center style='text-align:center'><img border=0
width=637 height=525 id="Picture 5" src="project_6_files/image006.png"></p>

<p class=MsoNormal><span lang=EN-US>Look in the Cloud watch log, we can see a
very good result after 15 training epochs:</span></p>

<p class=MsoListParagraphCxSpFirst style='text-indent:12px;'><span lang=EN-US>-<span
style='font:7.0pt "Times New Roman"'> &nbsp;
</span></span><span lang=EN-US>Train accuracy:�������� 0.9077 ~ 91%</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>-<span style='font:7.0pt "Times New Roman"'> &nbsp;
</span></span><span lang=EN-US>Valid accuracy: ������� 0.9738 ~ 98%</span></p>

<p class=MsoListParagraphCxSpLast style='text-indent:12px;'><span lang=EN-US>-<span
style='font:7.0pt "Times New Roman"'> &nbsp;
</span></span><span lang=EN-US>Test accuracy: ��������� 0.9729 ~ 97%</span></p>

<p class=MsoNormal><span lang=EN-US>From the train loss and valid loss, we see
that valid is still decrease, so the training is not overfitting, we can see
that if we have more training epochs, we can get more accuracy score.</span></p>

<p class=MsoNormal><span lang=EN-US>From the Sagemaker interface and Cloud
watch, we can get more information from this job, and we will use the training
job name for deploying our model to predict image class.</span></p>

<h2 style='text-indent:0in'><a name="_Toc93645212"></a><a name="_Toc92569611"><span
lang=EN-US>3. </span></a><span lang=EN-US>Deploying our model</span></h2>

<p class=MsoNormal><span lang=EN-US>From our training job name, we create the
endpoint on Aws.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>training_job_name
= </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>'pytorch-training-2022-01-19-11-46-10-633'</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>from</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>
sagemaker.predictor </span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#C586C0'>import</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> Predictor</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>from</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>
sagemaker.pytorch </span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#C586C0'>import</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> PyTorchModel</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>jpeg_serializer
= sagemaker.serializers.IdentitySerializer(</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>&quot;image/jpeg&quot;</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>json_deserializer
= sagemaker.deserializers.JSONDeserializer()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>model_name
= </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>'s3://</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#569CD6'>{}</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>/</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>{}</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>/output/model.tar.gz'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>.format(bucket,training_job_name)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>class</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>ImagePredictor</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>Predictor</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>):</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#569CD6'>def</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'> </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#DCDCAA'>__init__</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>self</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>endpoint_name</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>sagemaker_session</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>):</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#4EC9B0'>super</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(ImagePredictor, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>self</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>).</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>__init__</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; endpoint_name,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#9CDCFE'>sagemaker_session</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=sagemaker_session,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#9CDCFE'>serializer</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=jpeg_serializer,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#9CDCFE'>deserializer</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=json_deserializer,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; )</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>fn_model
= PyTorchModel(</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#9CDCFE'>model_data</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#D4D4D4'>=model_name, </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>role</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>=role,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>entry_point</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>'inference.py'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>py_version</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>'py38'</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>framework_version</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>'1.9'</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>predictor_cls</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=ImagePredictor</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )</span></p>

<p class=MsoNormal><span lang=EN-US>File <i>inference.py </i>is used as an
entry point. An important note is the used model in this entry point must be
the same as the model in our training job - <i>train_model.py</i>.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>from</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> time </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>import</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> time</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>since =
time()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>fn_predictor
= fn_model.deploy(</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#6A9955'># &nbsp;
&nbsp; data_capture_config = data_capture_config,</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>initial_instance_count</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#D4D4D4'>=</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>1</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>instance_type</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>=</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>&quot;ml.m5.large&quot;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; ) </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>print</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>f</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'Time
deploy: </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#569CD6'>{</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>time() - since</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#569CD6'>}</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#CE9178'> s'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>endpoint_name
= fn_predictor.endpoint_name</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>print</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(endpoint_name)</span></p>

<p class=MsoNormal><span lang=EN-US>The first time, there is an error:</span></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 1.0pt 1.0pt 4.0pt;
margin-left:.5in;margin-right:51.3pt'><pre style='word-break:break-all;
border:none;padding:0in'><span class=ansi-red-fg><span lang=EN-US
style='font-family:"var(--jp-code-font-family)",serif;color:#E75C58'>ModelError</span></span><span
lang=EN-US style='font-family:"var(--jp-code-font-family)",serif'>: An error occurred (ModelError) when calling the InvokeEndpoint operation: Received <br>
server error (500) from primary with message &quot;Given groups=1, weight of size [96, 3, 7, 7], expected input[1, 4, 224, 224] to have 3 channels, but got 4 channels instead</span></pre></div>

<p class=MsoNormal><span lang=EN-US>In the previous image classification
project dog-breed with resnet pretrained model, there is no such an error. There
is a different format of data input between resnet and densenet pretrained
model. We examine the <i>predict_fn</i> function in <i>inference.py</i> and see
that the torch object size is [1,4,12,12], our prediction code requires the
size [1,3,12,12], all the value of the torch [1,4,12,12] is 1. </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>def</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>predict_fn</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>input_object</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>model</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>):</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>logger</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#DCDCAA'>info</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'In
predict fn'</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>img_size</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> = </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>224</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>test_transform</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> = </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>transforms</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>.</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>Compose</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>([</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#4EC9B0'>transforms</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>.</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>Resize</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>img_size</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>),</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#4EC9B0'>transforms</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>.</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>ToTensor</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(),&nbsp;
&nbsp; </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; ])</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>logger</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#DCDCAA'>info</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>&quot;transforming
input&quot;</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>input_object </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>= </span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#9CDCFE'>test_transform</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>input_object</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#9CDCFE'>input_object</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> = </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>input_object</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>.to(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>device</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#C586C0'>with</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'> </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#4EC9B0'>torch</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>.</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>no_grad</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>():</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#9CDCFE'>logger</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>.</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>info</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>&quot;Calling
model&quot;</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#9CDCFE'>prediction</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> = </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>model</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>input_object</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>.unsqueeze(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>))</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#C586C0'>return</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#9CDCFE'>prediction</span></p>

<p class=MsoNormal><span lang=EN-US>We adjust our code a little bit - only insert
one line to adjust the torch object after tr�norming:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>input_object</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> = </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>input_object</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>[:</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>3</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,:,:]</span></p>

<p class=MsoNormal><span lang=EN-US>And it is ok to create the endpoint with
the deploy time is about 251 seconds.</span></p>

<p class=CodeStyleCxSpFirst><span lang=EN-US>--------!Time deploy:
250.71183037757874 s</span></p>

<p class=CodeStyleCxSpLast><span lang=EN-US>pytorch-inference-2022-01-19-20-17-22-679</span></p>

<p class=MsoNormal><span lang=EN-US>We write some code to get classid and
fielname of a random test image for our prediction.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>testset
= pd.read_csv(</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>'test.csv'</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>labels =
</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#4EC9B0'>list</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>(testset[</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#CE9178'>'label'</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>])</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>fullnames
= </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#4EC9B0'>list</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>(testset[</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#CE9178'>'fullname'</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>])</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>ef</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>get_file_classid</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>():</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; row = random.randint(</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>len</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(testset)-</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>1</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#C586C0'>return</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'> labels[row], fullnames[row] </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#6A9955'># ldic[row].values()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>print</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(get_file_classid())</span></p>

<p class=CodeStyle><span lang=EN-US>(0, 'data/test/0/airbus_s_000778.png')</span></p>

<p class=MsoNormal><span lang=EN-US>Now we try one prediction from our
endpoint.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>classid,
filename = get_file_classid()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>with</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>open</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(filename,
</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>&quot;rb&quot;</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>) </span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#C586C0'>as</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> f:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; payload = f.read()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>from</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>
sagemaker.serializers </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#C586C0'>import</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> IdentitySerializer</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>with</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>open</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(filename,
</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#CE9178'>&quot;rb&quot;</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>) </span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#C586C0'>as</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> f:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; payload = f.read()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>since =
time()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>fn_predictor.serializer
= IdentitySerializer(</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#CE9178'>&quot;image/jpeg&quot;</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>inference
= fn_predictor.predict(payload)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>print</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>f</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'Time
Prediction: </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#569CD6'>{</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>time() - since</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#569CD6'>}</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#CE9178'> s'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=CodeStyle><span lang=EN-US>Time Prediction: 0.45589208602905273 s</span></p>

<p class=MsoNormal><span lang=EN-US>Wonderful result, only about 0.46 second
for the prediction. We examine the output and how to get the predicted result.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>print</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#4EC9B0'>type</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(inference[</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>]),</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D7BA7D'>\n</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>len</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(inference[</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>]), </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D7BA7D'>\n</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>,
inference[</span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#B5CEA8'>0</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>])</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>prediction
= np.argmax(inference)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>if</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>
prediction == classid:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#DCDCAA'>print</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>(</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#CE9178'>'Prediction is correct'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>else</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#DCDCAA'>print</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>(</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#CE9178'>'Prediction is not correct'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>print</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(prediction,
filename, classid)</span></p>

<p class=CodeStyleCxSpFirst><span lang=EN-US>&lt;class 'list'&gt; </span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>�10 </span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>-[-0.31202423572540283,
-2.3471438884735107, 1.5576268434524536, 5.096643924713135, 1.6828807592391968,
1.3144971132278442, 3.891735076904297, -2.656201124191284, -1.17906653881073,
-3.5364975929260254]</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>Prediction is correct</span></p>

<p class=CodeStyleCxSpLast><span lang=EN-US>3 data/test/3/mouser_s_000061.png 3</span></p>

<p class=MsoNormal><span lang=EN-US>Since there are 10 labels, predicted result
is a list of 10 float number and the predicted label is the position in list
that is the maximum value of the list. We use function <i>argmax</i> of <i>numpy</i>
to get the predicted label. In this example, test file is <b><i>data/test/3/mouser_s_000061.png</i></b>,
and the real label is <b><i>3</i></b>, so the prediction is correct.</span></p>

<p class=MsoNormal><span lang=EN-US>Now we try 100 predictions:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>since =
time()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>preds =
[]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>count = </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>nums = </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>100</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>for</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> k </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>in</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>range</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(nums):</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; classid, filename = get_file_classid()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; classes.append(classid)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; files.append(filename)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#C586C0'>with</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'> </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#DCDCAA'>open</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(filename, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>&quot;rb&quot;</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>) </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>as</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> f:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; payload = f.read()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; inference = fn_predictor.predict(payload)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; infers.append(inference[</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#D4D4D4'>])</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; prediction = np.argmax(inference[</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>])</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; preds.append(prediction)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#C586C0'>if</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'> prediction == classid:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; count = count + </span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#B5CEA8'>1</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>print</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>f</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'Time </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>{</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>nums</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>}</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>
Prediction: </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#569CD6'>{</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>time() - since</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#569CD6'>: .02f}</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#CE9178'> s'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>accu =
count / nums</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>print</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>f</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'Accuracy
of 30 predictions: </span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#569CD6'>{</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>accu</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>: .04f}</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'> = </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>{</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>accu*</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>100</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>: .0f}</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>%'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=CodeStyleCxSpFirst><span lang=EN-US>Time 100 Prediction:- 12.43 s</span></p>

<p class=CodeStyleCxSpLast><span lang=EN-US>Accuracy of 100 predictions:-
0.8500 = 85%</span></p>

<p class=MsoNormal><span lang=EN-US>The accuracy score of 100 predictions is
about 85%, and the executive time of predicting is less than 13 second.</span></p>

<p class=MsoNormal><span lang=EN-US>Now we are ready to predict all the test
folder.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>from</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> time </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>import</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> time</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>since =
time()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>infers =
[]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>preds =
[]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>nums = </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>len</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(fullnames)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>for</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> k </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>in</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>range</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(nums):</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; filename = fullnames[k]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#C586C0'>with</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'> </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#DCDCAA'>open</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(filename, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>&quot;rb&quot;</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>) </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>as</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> f:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; payload = f.read()</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; inference = fn_predictor.predict(payload)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#6A9955'># Save the inference to check later</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; infers.append(inference[</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#D4D4D4'>])</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; prediction = np.argmax(inference[</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>0</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>])</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#6A9955'># Save the prediction to check later</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; preds.append(prediction)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>print</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>f</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'Time </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>{</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>nums</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>}</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>
Prediction: </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#569CD6'>{</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>time() - since</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#569CD6'>: .01f}</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#CE9178'> s'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=CodeStyle><span lang=EN-US>Time 10000 Prediction:- 1155.7 s</span></p>

<p class=MsoNormal><span lang=EN-US>Total executive time of predicting 10,000
test image is 1155.7s, less than 20 minutes. And we calculate the accuracy
score of all test image folder. We use pandas dataframe to save results to get
the exact result quickly and can save for reuse later.</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>df_prediction
= pd.DataFrame({</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#CE9178'>'label'</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>: labels,</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'pred'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>:
preds})</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>N = </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>len</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(labels)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>equal_inds
= df_prediction[</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#CE9178'>'label'</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>] == df_prediction[</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'pred'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>nums = </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>sum</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(equal_inds)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>accu =
nums / N </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#6A9955'># accu</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>print</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>f</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'Accuracy
of all test directory predictions: </span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#569CD6'>{</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>accu</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>: .04f}</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'> = </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>{</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>accu*</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>100</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>: .0f}</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>%'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>df_prediction.to_csv(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'prediction.csv'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>index</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>False</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=CodeStyle><span lang=EN-US>Accuracy of all test directory
predictions:- 0.8035 = 80%</span></p>

<p class=MsoNormal><span lang=EN-US>And we check the accuracy score of each
class:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>equal_inds
= df_prediction[</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#CE9178'>'label'</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>] == df_prediction[</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'pred'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>df_equal
= df_prediction[</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#CE9178'>'label'</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#D4D4D4'>][equal_inds]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>df_equal.reset_index(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>drop</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>True</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#9CDCFE'>inplace</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>=</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>True</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>classes
= {}</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>for</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> j </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>in</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>range</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>len</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(df_equal)):</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; k = df_equal[j]</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#C586C0'>if</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'> k </span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#569CD6'>not</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>in</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>
classes.keys():</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; classes[k] = </span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#B5CEA8'>1</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#C586C0'>else</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>:</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; &nbsp; &nbsp; classes[k] += </span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US
style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>CLS_LENGTH
= </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#B5CEA8'>1000</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>cls_ratio
= []</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>for</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> k </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#C586C0'>in</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'> </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#DCDCAA'>range</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>(</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#B5CEA8'>10</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>):</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; cls_ratio.append(classes[k]/CLS_LENGTH)</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:14.25pt;background:#1E1E1E'><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>&nbsp;
&nbsp; </span><span lang=EN-US style='font-size:10.5pt;font-family:Consolas;
color:#DCDCAA'>print</span><span lang=EN-US style='font-size:10.5pt;font-family:
Consolas;color:#D4D4D4'>(</span><span lang=EN-US style='font-size:10.5pt;
font-family:Consolas;color:#569CD6'>f</span><span lang=EN-US style='font-size:
10.5pt;font-family:Consolas;color:#CE9178'>'Accuracy of class </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>{</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>k</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>}</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>: </span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>{</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>cls_ratio[k]</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#569CD6'>: 0.4f}</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#CE9178'>'</span><span
lang=EN-US style='font-size:10.5pt;font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=CodeStyleCxSpFirst><span lang=EN-US>Accuracy of class 0:- 0.9280 ~ 93%</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>Accuracy of class 1:- 0.7880 ~
79%</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>Accuracy of class 2:- 0.8260 ~
83%</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>Accuracy of class 3:- 0.9030 ~
90%</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>Accuracy of class 4:- 0.8700 ~
87%</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>Accuracy of class 5:- 0.5850 ~
58%</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>Accuracy of class 6:- 0.7350 ~
74%</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>Accuracy of class 7:- 0.7410 ~
74%</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>Accuracy of class 8:- 0.9650 ~
96%</span></p>

<p class=CodeStyleCxSpLast><span lang=EN-US>Accuracy of class 9:- 0.6940 ~ 69%</span></p>

<p class=MsoNormal><span lang=EN-US>or we can use class name:</span></p>

<p class=CodeStyleCxSpFirst><span lang=EN-US>Accuracy of class airplane: 0.9280
~ ���� �93%</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>Accuracy of class automobile:
0.7880 ~ �� �79%</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>Accuracy of class bird: 0.8260 ���� ~
��� �83%</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>Accuracy of class cat: 0.9030 ����� ~
��� �90%</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>Accuracy of class deer: 0.8700 ���� ~
��� �87%</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>Accuracy of class dog: 0.5850 ����� ~
��� �58%</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>Accuracy of class frog: 0.7350 ���� ~
��� �74%</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>Accuracy of class horse: 0.7410 ��� ~
��� �74%</span></p>

<p class=CodeStyleCxSpMiddle><span lang=EN-US>Accuracy of class ship: 0.9650 ���� ~
��� �96%</span></p>

<p class=CodeStyleCxSpLast><span lang=EN-US>Accuracy of class truck: 0.6940 ��� ~
��� �69%</span></p>

<p class=MsoNormal><span lang=EN-US>The class dog has the smallest accuracy 58%
and the class ship has the maximum accuracy 96%. We have a small plot to
summary our predicted result.</span></p>

<p class=MsoNormal align=center style='text-align:center'><img border=0
width=398 height=277 id="Picture 6" src="project_6_files/image007.png"></p>

<h2 style='text-indent:0in'><a name="_Toc93645213"><span lang=EN-US>4. Research</span></a></h2>

<p class=MsoNormal style='margin-left:.5in'><span lang=EN-US>When researching
the same project with our data, in this page <a
href="https://nvsyashwanth.github.io/machinelearningmaster/cifar-10/">CIFAR 10
| Machine Learning Master</a>. </span></p>

<p class=MsoNormal style='margin-left:.5in'><span lang=EN-US>The author got the
scores from two models with 50 training epochs. </span></p>

<p class=MsoNormal align=center style='text-align:center'><img border=0
width=580 height=397 id="Picture 9" src="project_6_files/image008.png"></p>

<p class=MsoNormal align=center style='text-align:center'><img border=0
width=583 height=349 id="Picture 7" src="project_6_files/image009.png"></p>

<p class=MsoNormal><a name="_Toc92569612"><span lang=EN-US>Our result is much better.
We have a very good result after 15 training epochs</span></a></p>

<p class=MsoListParagraphCxSpFirst style='text-indent:12px;'><span lang=EN-US>-<span
style='font:7.0pt "Times New Roman"'> &nbsp;
</span></span><span lang=EN-US>Train accuracy:�������� 0.9077 ~ 91%</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>-<span style='font:7.0pt "Times New Roman"'> &nbsp;
</span></span><span lang=EN-US>Valid accuracy: ������� 0.9738 ~ 98%</span></p>

<p class=MsoListParagraphCxSpLast style='text-indent:12px;'><span lang=EN-US>-<span
style='font:7.0pt "Times New Roman"'> &nbsp;
</span></span><span lang=EN-US>Test accuracy: ��������� 0.9729 ~ 97%</span></p>

<h1 style='text-indent:-.5in'><a name="_Toc93645214"><span lang=EN-US>VI.<span
style='font:7.0pt "Times New Roman"'> &nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Conclusion</span></a></h1>

<p class=MsoListParagraphCxSpFirst style='text-indent:12px;'><span lang=EN-US>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>We examine and analyze the CIFAR-10 tar.gz file to transform from
pickle files into 3 folders of useful image data.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>We copy our image data into s3 bucket for Aws
Sagemaker Pytorch project.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>We perform a tuning job for our model on <i>ml.g4dn.4xlarge</i>
, and get the best hyperparameters for our training job.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>We complete the training job for our model on
Aws successfully.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>We get a very high accuracy for train, valid,
and test that are recorded in Cloud Watch logs. </span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>We deploy an endpoint for prediction on <i>ml.m5.large</i>
successfully.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>7.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>We try many predictions with our test images and
get many wonderful results. -</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>8.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>We analyze the accuracy of each classes in
10,000 test images and have a small plot to display this result.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>9.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>We completely perform the Pytorch image
classification problem from training to have a useful model, and from this
model we deploy the endpoint on Aws to predict with 10,000 test images with the
calculation of the successful ratio of each class.</span></p>

<p class=MsoListParagraphCxSpLast style='text-indent:12px;'><span lang=EN-US>10.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US>We
have a research to compare the result with ours.</span></p>

<h1 style='text-indent:-.5in'><a name="_Toc93645215"></a><a name="_Toc92569613"><span
lang=EN-US>VII.<span style='font:7.0pt "Times New Roman"'> &nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Improvement</span></a></h1>

<p class=MsoListParagraphCxSpFirst style='text-indent:12px;'><span lang=EN-US>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>We can review and test more to find the reason why the accuracy
through endpoint is much lower than the result from training - <i>97%</i> and <i>80%</i>.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>We can test more to compare more results from
two different optimizer optim.SGD and optim.Adam. In this project, we use
optim.SGD because when trying on local machine and Kaggle, optim.Adam is less
effective than optim.SGD.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>We can test more suitable image size in
torchvision transform to get the best suitable size. When test this model with
the image size is 224, we get the higher accuracy than inage size of 324, 512,
1024.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>We can test more various model to have the most
suitable one for our data.</span></p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:12px;'><span
lang=EN-US>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>We can use other compatible machine learning models
to learn more with these wonderful datasets.</span></p>

<p class=MsoListParagraphCxSpLast style='text-indent:12px;'><span lang=EN-US>6.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>There are many aspects that we can study to have more efficient
model.</span></p>

<h1 style='text-indent:-.5in'><a name="_Toc93645216"><span lang=EN-US>VIII.<span
style='font:7.0pt "Times New Roman"'> &nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>References</span></a></h1>

<p class=MsoListParagraphCxSpFirst style='margin-left:.75in;text-indent:12px;'><span
lang=EN-US>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US><a
href="https://sagemaker.readthedocs.io/en/stable/frameworks/pytorch/using_pytorch.html">sagemaker.readthedocs.io-using_pytorch.html</a></span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:.75in;text-indent:12px;'><span
lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US><a
href="https://sagemaker.readthedocs.io/en/stable/frameworks/pytorch/using_pytorch.html#train-a-model-with-pytorch">sagemaker.readthedocs.io-train-a-model-with-pytorch</a></span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:.75in;text-indent:12px;'><span
lang=EN-US>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US><a
href="https://sagemaker.readthedocs.io/en/stable/frameworks/pytorch/using_pytorch.html#deploy-pytorch-models">sagemaker.readthedocs.io-deploy-pytorch-models</a></span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:.75in;text-indent:12px;'><span
lang=EN-US>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US><a
href="https://aws.amazon.com/ec2/instance-types/g4/">Amazon EC2 G4 Instances -
Amazon Web Services (AWS)</a></span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:.75in;text-indent:12px;'><span
lang=EN-US>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US><a
href="https://ramseyelbasheer.io/2021/06/20/a-2021-guide-to-improving-cnns-optimizers-adam-vs-sgd/">A
2021 Guide to improving CNNs-Optimizers: Adam vs SGD - ML</a></span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:.75in;text-indent:12px;'><span
lang=EN-US>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US><a
href="https://pytorch.org/tutorials/beginner/transfer_learning_tutorial.html">Transfer
Learning for Computer Vision Tutorial - PyTorch Tutorials</a></span></p>

<p class=MsoListParagraphCxSpLast style='margin-left:.75in;text-indent:12px;'><span
lang=EN-US>7.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US><a
href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.plot.html">Matplotlib.pyplot.plot
- Matplotlib 3.5.1 documentation</a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;
margin-left:0in;line-height:107%'><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-top:0in;margin-right:0in;margin-bottom:8.0pt;
margin-left:0in;line-height:107%'><span lang=EN-US>&nbsp;</span></p>

</div>

</body>

</html>
